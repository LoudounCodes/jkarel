<project name="fcpsKarel" default="jar" basedir=".">
    <property name = "src.dir" value = "src"/>
    <property name = "build.dir" value = "scratch"/>
    <property name = "output.dir" value = "out"/>
    <property name = "lib.dir" value = "lib"/>
    <property name = "version" value = "3.0.0"/>
    
    <path id = "dependencies">
       <fileset dir = "lib">
          <include name = "*.jar"/>
       </fileset>
     </path>

    <target name="prerequisite-build">
      <mkdir dir="${build.dir}"/>
      <mkdir dir="${output.dir}"/>
    </target>
     
    <target name="build-all" depends="prerequisite-build">
        <javac srcdir = "${src.dir}"
               destdir = "${build.dir}">
               
          <classpath refid = "dependencies" />
        </javac>
    </target>
    
    
    <pathconvert property="manifest.classpath" pathsep=" ">
      <path refid="dependencies"/>
      <mapper>
        <chainedmapper>
           <flattenmapper/>
           <globmapper from="*.jar" to="lib/*.jar"/>
        </chainedmapper>
      </mapper>
    </pathconvert>
    
    
    <target name="jar" depends="build-all">
      <jar destfile="${output.dir}/fcpskarel-${version}.jar">
        <manifest>
          <attribute name="Class-Path" value="${manifest.classpath}"/>
        </manifest>
        <fileset dir="${build.dir}"/>
        <fileset dir=".">
          <filename name="lib/*.jar"/>
        </fileset>
        

        <fileset dir=".">
          <filename name="README"/>
        </fileset>
        <fileset dir=".">
          <filename name="LICENSE.TXT"/>
        </fileset>
        <fileset dir=".">
          <filename name="**/*.java"/>
        </fileset>
        
      </jar>
    </target>
    
    <target name="clean">
      <delete dir="${build.dir}"/>
      <delete dir="${output.dir}"/>
    </target>
    
    <target name="docs">
        <javadoc sourcepath="." classpath=".:xercesImpl.jar" destdir="docs" packagenames="edu.fcps.*" />
    </target>

</project>
